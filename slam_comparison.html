<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Swapnil Meshram's portfolio showcasing his graduate project where he performed comparative analysis of SLAM algorithms.">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Swapnil Meshram</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="50x50" href="images/swapnil_fav.jpg" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <noscript><link rel="stylesheet" href="assets/css/noscript.css"></noscript>

    <!-- Preload the chevron font so it’s cached early -->
    <link rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/webfonts/fa-solid-900.woff2"
      as="font" type="font/woff2" crossorigin>

    <!-- FontAwesome for zoom icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <!-- Slick Carousel CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    
<style>
/* ───────────── General UI ───────────── */

/* Fade transition for overlay image swaps */
.fullscreen-image img.zoomable{
  cursor:grab;
  touch-action:none;
  transform-origin:center center;
  transition:opacity .4s ease,transform .1s ease-out;
}

/* Fade each <video> exactly like each <img> */
.fullscreen-video video{
  opacity:1;
  transition:opacity .4s ease;
}

/* ───── Slick arrows (Font-Awesome chevrons) ───── */
.slick-prev,
.slick-next{
  background:none;
  border:none!important;
  outline:0;
  box-shadow:none;
  width:50px;
  height:50px;
  cursor:pointer;
  position:absolute;
  top:50%;
  transform:translateY(-50%);
}
.slick-prev{left:-60px;}
.slick-next{right:-60px;}

.slick-prev:before,
.slick-next:before{
  font-family:"Font Awesome 5 Free";
  font-weight:900;
  font-size:48px;
  line-height:1;
  color:rgba(50,50,50,.9);
}
.slick-prev:before{content:"\f053";}
.slick-next:before{content:"\f054";}

.slick-prev:hover:before,
.slick-next:hover:before{color:#283a8b;}

/* Inline-carousel arrow sizing */
@media (max-width:768px){
  .slick-prev,.slick-next{width:34px;height:34px;}
  .slick-prev:before,.slick-next:before{font-size:30px;}
}
@media (max-width:480px){
  .slick-prev,.slick-next{width:30px;height:30px;}
  .slick-prev:before,.slick-next:before{font-size:26px;}
  .slick-prev{left:-30px;}
  .slick-next{right:-30px;}
}

/* ─── Overlay-specific arrow buttons ─── */
.fs-arrow{
  background:none;
  border:none;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
  cursor:pointer;
}

/* Hide Slick’s built-in chevrons **only** when .fs-arrow is present */
.fs-arrow:before{content:none!important;}

/* Hover/active feedback */
.fs-arrow:active i,
.fs-arrow:hover  i{transform:scale(1.15);}

/* Icon style; size is set with a variable later */
.fs-arrow i{
  color:#fff;
  line-height:1;
  filter:drop-shadow(0 0 4px rgba(0,0,0,.4));
}

/* Phones ≤480 px (inline carousels only) */
@media (max-width:480px){
  .fs-arrow{width:28px;height:28px;}
  .fs-arrow i{font-size:1.45rem;} /* ≈23 px */
}

/* ───────────── Dots / layout / misc ───────────── */
.image-label,.video-label{
  text-align:center;
  font-size:16px;
  margin-top:5px;
  color:rgba(50,50,50);
}
.image-citation,.video-citation{
  margin-top:5px;
  font-size:12px;
  text-align:center;
}

.slick-dots{
  position:absolute;
  bottom:10px;
  width:100%;
  text-align:center;
}
.slider{
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  position:relative;
}
.slider .slide-content{
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  margin:20px 0;
}

/* Hollow rings for Slick dots */
.slick-dots li button{
  border:none!important;
  background:transparent!important;
  padding:0;
  outline:none;
}
.slick-dots li button:before{
  content:'';
  display:inline-block;
  width:12px;height:12px;
  border:2px solid rgba(50,50,50,.7);
  border-radius:50%;
  margin:0 6px;
  transition:background .2s ease,transform .2s ease;
}
.slick-dots li button:hover:before{transform:scale(1.2);}
.slick-dots li.slick-active button:before{
  background:#283a8b;
  border-color:#283a8b;
}

.video-container{position:relative;width:100%;max-width:600px;margin:0 auto;}
.slider .slide-content img,
.slider .slide-content video{
  max-width:600px;width:100%;height:auto;
  display:block;margin:0 auto;
  border:1px solid rgba(50,50,50);
  padding:6px;
}
@media(max-width:600px){
  .slider .slide-content img,
  .slider .slide-content video{padding:5px;}
}

/* Hover scale */
.image,.video{cursor:pointer;transition:transform .25s ease;}
.image:hover,.video:hover{transform:scale(1.01);}

/* ───────────── Full-screen overlay wrappers ───────────── */
.fullscreen-video,
.fullscreen-image{
  position:fixed;top:0;left:0;width:100%;height:100vh;
  background:rgba(0,0,0,.8);
  z-index:9999;
  display:flex;justify-content:center;align-items:center;
  touch-action:none;
}
@supports(height:100dvh){
  .fullscreen-video,
  .fullscreen-image{height:100dvh;}  /* iOS Chrome fix */
}

.fullscreen-video video,
.fullscreen-image img{max-width:90%;max-height:90%;}

.blurred-background{filter:blur(5px);}
.close-button{
  position:absolute;top:25px;right:25px;
  width:32px;height:32px;
  background:url('images/close-icon.png') no-repeat center/cover;
  cursor:pointer;z-index:10000;
}

/* Zoom controls */
.zoom-controls {
  position: absolute;         /* take it out of the flow */
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;    /* vertical / horizontal padding */
  background: rgba(0,0,0,0.6);
  border-radius: 9999px;      /* fully rounded ends */
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;

  /* start hidden & fade-in on hover/focus */
  opacity: 0;
  transition: opacity 0.3s ease;
  }

  .fullscreen-image:hover .zoom-controls,
  .zoom-controls:focus-within {
    opacity: 1;
}

.zoom-btn {
  background: transparent;    /* remove per-button circle */
  border: none;
  width: auto; height: auto;  /* let padding define hit area */
  padding: 0.25rem;           /* click‐area around the icon */
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #fff !important;     /* icon color */
  font-size: 1rem;            /* scale the icon up a bit */
}

.zoom-btn:hover {
  background: rgba(255,255,255,0.15);
  border-radius: 50%;
}

/* Responsive project text */
.project-text{font-size:1.175rem;line-height:1.6;}
@media(max-width:1280px){.project-text{font-size:1.1rem;}}
@media(max-width:736px){.project-text{font-size:1rem;}}

/* Play icon overlay on videos */
.play-icon{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:64px;height:64px;
  background:url('images/play-icon.png') no-repeat center/cover;
  opacity:.8;cursor:pointer;
}
.play-icon:hover{transform:translate(-50%,-50%) scale(1.2);}
@media(max-width:480px){.play-icon{top:50%;}}

/* ─── Base overlay-arrow positioning ─── */
.fullscreen-image .slick-prev,
.fullscreen-video .slick-prev,
.fullscreen-image .slick-next,
.fullscreen-video .slick-next{
  top:50%;
  transform:translateY(-50%);
  z-index:10001;
}

/* ───────── FULL-SCREEN-ONLY arrow sizing (single variable) ───────── */
.fullscreen-image,
.fullscreen-video{ --fs-arrow-size:48px; }      /* desktop */
@media (max-width:768px){
  .fullscreen-image,
  .fullscreen-video{ --fs-arrow-size:34px; }    /* tablets */
}
@media (max-width:480px){
  .fullscreen-image,
  .fullscreen-video{ --fs-arrow-size:28px; }    /* phones */
}
.fullscreen-image .fs-arrow,
.fullscreen-video .fs-arrow{
  width:var(--fs-arrow-size);
  height:var(--fs-arrow-size);
}
.fullscreen-image .fs-arrow i,
.fullscreen-video .fs-arrow i{
  font-size:var(--fs-arrow-size);
}

/* Absolutely hide any Slick pseudo-glyph that might still appear */
.fullscreen-image .slick-prev:before,
.fullscreen-image .slick-next:before,
.fullscreen-video .slick-prev:before,
.fullscreen-video .slick-next:before{content:none!important;}

/* ────────────────────────────────────────────────
   𝗙𝗶𝘅𝗲𝗱-𝗼𝗳𝗳𝘀𝗲𝘁 𝗮𝗿𝗿𝗼𝘄 𝗹𝗮𝘆𝗼𝘂𝘁  (matches SLAM page)
   ──────────────────────────────────────────────── */

/* Desktop / large screens */
.fullscreen-image .slick-prev,
.fullscreen-video .slick-prev{
  left:calc((100% - 90%) / 2 + .5rem)!important;
  right:auto!important;
}
.fullscreen-image .slick-next,
.fullscreen-video .slick-next{
  right:calc((100% - 90%) / 2 + .5rem)!important;
  left:auto!important;
}

/* Tablets ≤ 768 px */
@media (max-width:768px){
  .fullscreen-image .slick-prev,
  .fullscreen-video .slick-prev{left:1rem!important;}
  .fullscreen-image .slick-next,
  .fullscreen-video .slick-next{right:1rem!important;}
}

/* Phones ≤ 480 px */
@media (max-width:480px){
  .fullscreen-image .slick-prev,
  .fullscreen-video .slick-prev{left:.5rem!important;}
  .fullscreen-image .slick-next,
  .fullscreen-video .slick-next{right:.5rem!important;}
}
</style>

</head>
<body class="is-preload">

<!-- Header -->
<header id="header">
    <a href="index.html#three" class="title">From Circuit Boards to Robots: Projects in Embedded Systems & Robotics</a>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
        </ul>
    </nav>
</header>

<!-- Wrapper -->
<div id="wrapper">

    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">Comparative Analysis of SLAM Algorithms</h1>
            <div class="slider">
                <div class="slide-content">
                    <a href="images/slam_1.png" class="image" onclick="showFullScreenImage('images/slam_1_1.png'); return false;">
                        <img src="images/slam_1.png" alt="GMapping Algorithm" loading="lazy">
                    </a>
                    <p class="image-label">Image 1: Yahboom ROS Master X3 Robot</p>
                    <p class="image-citation">Description: The Yahboom ROS Master X3 robot, equipped with an RPLIDAR sensor and Orbbec depth camera, was used for this SLAM project. For more details, visit the <a href="http://www.yahboom.net/study/ROSMASTER-X3" target="_blank">Yahboom ROS Master X3 website</a>.</p>
                </div>
                <div class="slide-content">
                    <div class="video-container">
                        <video class="video" muted>
                            <source src="images/slam_demo_1.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div class="play-icon" onclick="playFullScreen('images/Layout1.MP4', true)"></div>
                    </div>
                    <p class="video-label">Video 1: SLAM Algorithm Performance in Layout 1</p>
                    <p class="video-citation">Description: This video demonstrates the performance of GMapping and Cartographer SLAM algorithms in Layout 1, a simpler indoor environment. The video highlights the mapping accuracy and structural precision achieved by each algorithm.</p>
                </div>
                <div class="slide-content">
                    <div class="video-container">
                        <video class="video" muted>
                            <source src="images/slam_demo_2.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div class="play-icon" onclick="playFullScreen('images/Layout2.MP4', true)"></div>
                    </div>
                    <p class="video-label">Video 2: SLAM Algorithm Performance in Layout 2</p>
                    <p class="video-citation">Description: This video showcases the performance of GMapping and Cartographer SLAM algorithms in Layout 2, a more complex indoor environment. The video illustrates how each algorithm handles obstacles and varying layouts.</p>
                </div>
                <div class="slide-content">
                    <a href="images/cartographer_vs_ground_truth.png" class="image" onclick="showFullScreenImage('images/cartographer_vs_ground_truth_1.png'); return false;">
                        <img src="images/cartographer_vs_ground_truth.png" alt="SLAM Mapping Results" loading="lazy">
                    </a>
                    <p class="image-label">Image 3: Cartographer SLAM vs. Ground Truth</p>
                    <p class="image-citation">Description: Comparison of Cartographer SLAM's map with the ground truth, showing high accuracy in capturing the overall structure with minor discrepancies.</p>
                </div>
                <div class="slide-content">
                    <a href="images/gmapping_vs_ground_truth.png" class="image" onclick="showFullScreenImage('images/gmapping_vs_ground_truth_1.png'); return false;">
                        <img src="images/gmapping_vs_ground_truth.png" alt="SLAM in Complex Environments" loading="lazy">
                    </a>
                    <p class="image-label">Image 4: GMapping SLAM vs. Ground Truth</p>
                    <p class="image-citation">Description: Comparison of GMapping SLAM's map with the ground truth, demonstrating good performance in simpler environments with some deviations.</p>
                </div>
            </div>
            <p class="text-justify project-text">This project investigates the performance and accuracy of two widely used Simultaneous Localization and Mapping (SLAM) algorithms, GMapping and Cartographer, for indoor robotic navigation. SLAM plays a crucial role in enabling autonomous systems to map their environment and localize themselves within unfamiliar surroundings. In this study, we focused on GMapping, which utilizes a 2D grid-based particle filter approach, and Cartographer, which employs a graph-based method capable of both 2D and 3D mapping.</p>
            <p class="text-justify project-text">The experimental setup involved the Yahboom ROS Master X3 robot equipped with an RPLIDAR sensor, collecting real-time data across controlled indoor environments with varying levels of complexity. Mapping accuracy was quantitatively evaluated using Mean Squared Error (MSE) and Mean Absolute Error (MAE) by comparing the generated maps against ground truth references.</p>
            <p class="text-justify project-text">The key findings from this comparative analysis were:</p>
            <ul class="text-justify project-text">
                <li>GMapping demonstrated superior performance in structured, simpler environments with fewer obstacles.</li>
                <li>Cartographer achieved higher accuracy in complex layouts containing multiple obstacles.</li>
            </ul>
            <p class="text-justify project-text">A significant challenge identified during this study was the presence of blind spots caused by the LIDAR's fixed mounting height (7 inches), which limited the detection of lower obstacles. Additionally, the absence of standardized evaluation methodologies for SLAM systems posed difficulties in achieving consistent quantitative comparisons.</p>
            <p class="text-justify project-text">To address these limitations, the project proposes the integration of additional depth sensors or cameras to enhance obstacle detection coverage and improve overall mapping reliability. This research provides valuable insights into algorithm selection, sensor configuration, and evaluation strategies, contributing to the development of more robust and adaptive autonomous systems.</p>
            <p class="text-justify project-text">By critically analyzing the performance of these SLAM algorithms under real-world constraints, the project emphasizes the importance of aligning algorithm capabilities with environmental challenges, reinforcing the vital role of SLAM in modern robotics.</p>
        </div>
    </section>

</div>

<!-- Footer -->
<footer id="footer" class="wrapper alt">
    <div class="inner">
        <ul class="menu">
            <li>&copy; 2016-2025 Swapnil Meshram</li>
        </ul>
    </div>
</footer>

<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/jquery.scrolly.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

<script>
/* ──────────────────────────────────────────
   1.  MAIN SLIDER
────────────────────────────────────────── */
const $slider = $('.slider');

/* centre inline-carousel arrows on the active image */
function positionArrows () {
  const $img = $slider.find('.slick-current img');
  if (!$img.length) return;                       /* current slide is video */

  if (!$img[0].naturalHeight) {                   /* wait for lazy-loaded img */
    $img.on('load', positionArrows);
    return;
  }
  const imgBox   = $img[0].getBoundingClientRect();
  const slideBox = $slider[0].getBoundingClientRect();
  const mid      = imgBox.top + imgBox.height / 2 - slideBox.top;
  $slider.find('.slick-prev, .slick-next').css('top', mid + 'px');
}

$slider.on('init setPosition afterChange', positionArrows);

$slider.slick({
  autoplay: true,
  dots: true,
  arrows: true,
  infinite: true,
  speed: 800,
  cssEase: 'cubic-bezier(0.7,0,0.3,1)',
  slidesToShow: 1,
  slidesToScroll: 1
});

const slickInst = $slider.slick('getSlick');
$(window).on('resize orientationchange', positionArrows);

/* ──────────────────────────────────────────
   2.  UTILITY  – blur background when overlay is open
────────────────────────────────────────── */
function blurPage (on) {
  document.body.classList.toggle('fullscreen-mode', on);
  document.getElementById('wrapper').classList.toggle('blurred-background', on);
}

/* ──────────────────────────────────────────
   3.  FULL-SCREEN VIDEO OVERLAY
────────────────────────────────────────── */
function playFullScreen (videoSrc, autoPlay = false) {
  const ov = document.createElement('div');
  ov.className = 'fullscreen-video';
  ov.innerHTML = `
    <div class="close-button" onclick="closeFullScreen()"></div>
    <button class="slick-prev fs-arrow" aria-label="Previous">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="slick-next fs-arrow" aria-label="Next">
      <i class="fas fa-chevron-right"></i>
    </button>

    <video src="${videoSrc}" playsinline muted style="opacity:0"></video>
    <div class="play-icon" aria-hidden="true"></div>
  `;
  document.body.appendChild(ov);
  blurPage(true);

  const vid     = ov.querySelector('video');
  const playBtn = ov.querySelector('.play-icon');
  requestAnimationFrame(() => { vid.style.opacity = 1; });

  vid.addEventListener('play', () => {
    playBtn.style.display = 'none';
    vid.setAttribute('controls', '');
  });

  if (autoPlay) vid.play().catch(() => {});
  playBtn.addEventListener('click', () => vid.play());

  /* cross-fade to next / prev slide */
  function jump (dir) {
    vid.style.opacity = 0;
    vid.addEventListener('transitionend', function handle () {
      vid.removeEventListener('transitionend', handle);

      dir < 0 ? slickInst.slickPrev() : slickInst.slickNext();
      const slide = slickInst.$slides.eq(slickInst.currentSlide);
      const vSrc  = slide.find('video source').attr('src');

      if (vSrc) {                            /* next is video  */
        vid.pause();
        vid.removeAttribute('controls');
        playBtn.style.display = '';
        vid.src = vSrc;
        vid.load();
        requestAnimationFrame(() => { vid.style.opacity = 1; });
      } else {                               /* next is image */
        closeFullScreen();
        showFullScreenImage(slide.find('a.image').attr('href'));
      }
    });
  }
  ov.querySelector('.slick-prev').onclick = () => jump(-1);
  ov.querySelector('.slick-next').onclick = () => jump(1);

  document.addEventListener('keydown', function esc (e) {
    if (e.key === 'Escape') {
      document.removeEventListener('keydown', esc);
      closeFullScreen();
    }
  });
}

/* ──────────────────────────────────────────
   4.  FULL-SCREEN IMAGE OVERLAY
────────────────────────────────────────── */
function showFullScreenImage (src, evt) {
  if (evt) evt.preventDefault();

  let idx      = slickInst.currentSlide;
  const slide  = slickInst.$slides.eq(idx);

  /* if current slide is video, delegate */
  if (slide.find('video').length) {
    playFullScreen(slide.find('video source').attr('src'));
    return;
  }

  const ov = document.createElement('div');
  ov.className = 'fullscreen-image';
  ov.innerHTML = `
    <div class="close-button" onclick="closeFullScreen()"></div>
    <button class="slick-prev fs-arrow" aria-label="Previous">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="slick-next fs-arrow" aria-label="Next">
      <i class="fas fa-chevron-right"></i>
    </button>
    <div class="zoom-controls">
      <button class="zoom-btn zoom-out"  aria-label="Zoom out"><i class="fas fa-minus"></i></button>
      <button class="zoom-btn zoom-reset" aria-label="Reset zoom"><i class="fas fa-search"></i></button>
      <button class="zoom-btn zoom-in"   aria-label="Zoom in"><i class="fas fa-plus"></i></button>
    </div>
    <img src="${src}" alt="" class="zoomable" loading="lazy">
  `;
  document.body.appendChild(ov);
  blurPage(true);

  const img = ov.querySelector('img.zoomable');

  /* ----- zoom & pan state ----- */
  let scale   = 0.85,
      offsetX = 0,
      offsetY = 0;
  img.style.transform = `translate(0,0) scale(${scale})`;

  /* swap slides (image or video) */
  function swapSlide () {
    const s   = slickInst.$slides.eq(idx);
    const vid = s.find('video source').attr('src');

    if (vid) { closeFullScreen(); playFullScreen(vid); return; }

    const newSrc = s.find('a.image').attr('href');
    img.style.opacity = 0;
    img.addEventListener('transitionend', function t () {
      img.removeEventListener('transitionend', t);
      img.src = newSrc;
      requestAnimationFrame(() => { img.style.opacity = 1; });
    });
  }

  ov.querySelector('.slick-prev').onclick = () => {
    idx = (idx - 1 + slickInst.slideCount) % slickInst.slideCount;
    swapSlide();
  };
  ov.querySelector('.slick-next').onclick = () => {
    idx = (idx + 1) % slickInst.slideCount;
    swapSlide();
  };

  /* ----- zoom helpers ----- */
  function update () {
    img.style.transform = `translate(${offsetX}px,${offsetY}px) scale(${scale})`;
  }
  ov.querySelector('.zoom-in').onclick    = () => { scale = Math.min(scale * 1.2, 3); update(); };
  ov.querySelector('.zoom-out').onclick   = () => { scale = Math.max(scale * 0.8, 0.5); update(); };
  ov.querySelector('.zoom-reset').onclick = () => { scale = 0.85; offsetX = offsetY = 0; update(); };

  ov.addEventListener('wheel', e => {
    e.preventDefault();
    scale *= e.deltaY < 0 ? 1.1 : 0.9;
    scale  = Math.min(Math.max(scale, 0.5), 3);
    update();
  }, { passive:false });

  /* drag-to-pan (mouse) */
  let dragging = false, sx, sy;
  img.addEventListener('mousedown', e => {
    e.preventDefault();
    dragging = true;
    sx = e.clientX; sy = e.clientY;
    img.style.cursor = 'grabbing';
  });
  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    offsetX += e.clientX - sx; offsetY += e.clientY - sy;
    sx = e.clientX; sy = e.clientY;
    update();
  });
  document.addEventListener('mouseup', () => {
    dragging = false; img.style.cursor = 'grab';
  });
  ov.addEventListener('mouseleave', () => {
    dragging = false; img.style.cursor = 'grab';
  });

  /* pinch-to-zoom (touch) */
  function dist(t1, t2) { return Math.hypot(t1.clientX - t2.clientX,
                                           t1.clientY - t2.clientY); }
  let pinchStart = null, touchDrag = false, tx, ty;
  ov.addEventListener('touchstart', e => {
    if (e.touches.length === 2)      pinchStart = dist(e.touches[0], e.touches[1]);
    else if (e.touches.length === 1) { touchDrag = true; tx = e.touches[0].clientX; ty = e.touches[0].clientY; }
  }, { passive:false });
  ov.addEventListener('touchmove', e => {
    if (e.touches.length === 2 && pinchStart !== null) {
      e.preventDefault();
      scale = Math.min(Math.max(scale * (dist(e.touches[0], e.touches[1]) / pinchStart), 0.5), 3);
      pinchStart = dist(e.touches[0], e.touches[1]);
      update();
    } else if (e.touches.length === 1 && touchDrag) {
      e.preventDefault();
      offsetX += e.touches[0].clientX - tx;
      offsetY += e.touches[0].clientY - ty;
      tx = e.touches[0].clientX; ty = e.touches[0].clientY;
      update();
    }
  }, { passive:false });
  ov.addEventListener('touchend', e => {
    if (e.touches.length < 2) pinchStart = null;
    if (e.touches.length === 0) touchDrag = false;
  });

  document.addEventListener('keydown', function esc (e) {
    if (e.key === 'Escape') {
      document.removeEventListener('keydown', esc);
      closeFullScreen();
    }
  });
}

/* ──────────────────────────────────────────
   5.  CLOSE OVERLAY
────────────────────────────────────────── */
function closeFullScreen () {
  const ov =
    document.querySelector('.fullscreen-image') ||
    document.querySelector('.fullscreen-video');
  if (!ov) return;
  ov.remove();
  blurPage(false);
}
</script>

</body>
</html>
